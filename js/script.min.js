const minifyButton=document.getElementById("minify"),copyButton=document.getElementById("copy"),anitext=document.getElementById("anitext"),errorMessage=document.getElementById("errmsg"),pysource=document.getElementById("source"),dwButton=document.getElementById("dw"),shareButton=document.getElementById("share"),dropArea=document.getElementById("dropArea"),fileInput=document.getElementById("fileInput"),fileNameDisplay=document.getElementById("fileNameDisplay"),minifiedSizeSpan=document.getElementById("minified-size"),fileLink_load=document.getElementById("fileLink-load"),qrCode=document.getElementById("qrCode"),copy_msg=document.getElementById("copy-msg"),file_Link=document.getElementById("fileLink"),close_Popup=document.getElementById("closePopup"),popup=document.getElementById("popup"),overlay=document.getElementById("overlay"),orscan=document.getElementById("scantocopy"),help_msg=document.getElementById("help-msg"),link_newtab=document.getElementById("new_tab"),fileLinkInput=document.getElementById("fileLinkInput"),selectallopt=document.getElementById("selectall"),unselectallopt=document.getElementById("Unselectall"),preservedGlobalsInput=document.getElementById("preserve_globals");var content=document.querySelector(".content-ll"),checkboxes=document.querySelectorAll('input[type="checkbox"]');let errorTimeout,cpyTimeout0,cpyTimeout1,readonlyTimeout;const maxFileSizeInBytes=1048576,excir='<i class="fa-solid fa-circle-exclamation"></i>',exctri='<i class="fa-solid fa-file-circle-exclamation"></i>',code_file='<i class="fa-solid fa-file-code"></i>',classlst=["select-none","font-bold","bg-red-500","text-white","py-1","px-2","rounded","max-w-fit","mt-4"],classlst0=["select-none","font-bold","bg-green-500","text-white","py-1","px-2","rounded","max-w-fit","mt-4"];var words=["and","as","assert","break","class","continue","def","del","elif","else","except","False","finally","for","from","global","if","import","in","is","lambda","None","nonlocal","not","or","pass","raise","return","True","try","while","with","yield","abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip","exec","Ellipsis","NotImplemented"];const sentences=["A Python minifier is a tool used to shrink Python code size by eliminating unnecessary elements like white spaces, comments, and line breaks.","Its primary purpose is to enhance the loading speed of Python scripts, particularly beneficial for web applications.","By reducing the overall size of the code, the minifier contributes to faster script loading times, optimizing web performance.","The process of minification streamlines code readability without affecting its functionality or logic.","Minified code is more efficiently transmitted and executed across various platforms, aiding developers in delivering smoother user experiences.","Minification is a standard practice for web optimization, mitigating download and execution times of scripts to create a more responsive environment."],dateformat={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",timeZoneName:"short"},features=[{text:"Efficiency",color:"#4CAF50"},{text:"Safety",color:"#2196F3"},{text:"Quick",color:"#FF9800"},{text:"Speed",color:"#673AB7"},{text:"Reliability",color:"#F44336"},{text:"Protection",color:"#009688"},{text:"Robust",color:"#c775c9"}];function shuffleArray(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}shuffleArray(features);const typewriter=new Typewriter(anitext,{loop:!0,delay:50});features.forEach(((e,t)=>{typewriter.pauseFor(1e3).deleteAll().typeString(`<span style="color: ${e.color}">${e.text}</span>`).pauseFor(1e3).callFunction((()=>{t===features.length-1&&typewriter.stop()}))})),window.addEventListener("load",(()=>{typewriter.start()})),document.getElementById("year").textContent=(new Date).getFullYear().toString();var sourceEditor=CodeMirror.fromTextArea(pysource,{mode:"python",theme:"mdn-like",lineNumbers:!0,viewportMargin:20,placeholder:"Enter original code...",matchBrackets:!0,autoCloseBrackets:!0,hint:CodeMirror.hint.anyword,scrollbarStyle:"overlay",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0,extraKeys:{"Ctrl-Space":"autocomplete"}}),minifiedEditor=CodeMirror.fromTextArea(document.getElementById("minified"),{mode:"python",theme:"mdn-like",lineNumbers:!0,readOnly:!0,viewportMargin:20,scrollbarStyle:"overlay",matchBrackets:!0,placeholder:"Minified code...",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0});function updateEditorState(){var e=sourceEditor.getCursor(),t=sourceEditor.getValue(),n=new Blob([t]).size;n>1048576?(handleFilename(),handleErrorMessage(`${exctri} Maximum Size limit 1MB reached!`),sourceEditor.setValue(t.substring(0,t.length-(n-1048576))),sourceEditor.setOption("readOnly",!0)):sourceEditor.setOption("readOnly",!1),sourceEditor.setCursor(e)}function readonlyalert(){readonlyTimeout&&clearTimeout(readonlyTimeout),event.key.startsWith("Arrow")||0===minifiedEditor.getValue().length||(event.preventDefault(),minifiedSizeSpan.innerHTML=`${excir} Read-Only`,readonlyTimeout=setTimeout((()=>{minifiedSizeSpan.textContent=`${(minifiedEditor.getValue().length/1024).toFixed(3)} kB`,readonlyTimeout=null}),2e3))}function setupFileInput(){function e(e){const n=e.dataTransfer.files[0];n&&(n.name.toLowerCase().endsWith(".py")?(handleErrorMessage(),handleFilename(`${code_file} ${n.name}`),t(n)):(handleFilename(),handleErrorMessage(`${exctri} Invalid file format. Please select a .py file.`)))}function t(e){if(e.size<=1048576){const t=new FileReader;t.onload=e=>{sourceEditor.getDoc().setValue(e.target.result),handleErrorMessage()},t.readAsText(e)}else handleFilename(),handleErrorMessage(`${exctri} File size exceeds 1MB. Please select a smaller file.`),fileInput.value=""}fileInput.addEventListener("change",(e=>{const n=e.target.files[0];n&&(n.name.toLowerCase().endsWith(".py")?(handleErrorMessage(),handleFilename(`${code_file} ${n.name}`),t(n)):(dwButton.disabled=!0,handleFilename(),handleErrorMessage(`${exctri} Invalid file format. Please select a .py file.`),fileInput.value=""))})),dropArea.addEventListener("click",(()=>{fileInput.click()})),document.addEventListener("dragover",(e=>{e.preventDefault()})),document.addEventListener("drop",(t=>{t.preventDefault(),e(t)})),dropArea.addEventListener("drop",(t=>{t.preventDefault(),e(t)}))}function dw_py(){animateIcon("fade-1","fa-fade",3e3);var e=new Blob([minifiedEditor.getValue()],{type:"text/x-python"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=(fileNameDisplay.textContent||"default.py").replace(/^ /,"").replace(/\.[^/.]+$/,"")+"_min.py",n.click(),URL.revokeObjectURL(t)}function validateCH(e){animateIcon("fade-2","fa-fade",2e3),e.preventDefault(),hcaptcha.execute()}async function Sharelink(e){animateIcon("fade-2","fa-fade",3e3);const t=minifiedEditor.getValue(),n=(fileNameDisplay.textContent||"default.py").replace(/^ /,"").replace(/\.[^/.]+$/,"")+"_min.py";try{const e=await fetch("https://file.io/?expires=2w",{method:"POST",body:createFormData(t,n)}),i=await e.json();if(i.success){const e=i.link;overlay.classList.remove("hidden"),popup.classList.remove("hidden"),document.body.classList.add("overflow-y-hidden"),document.body.classList.remove("overflow-y-scroll"),file_Link.classList.add("hidden"),copy_msg.textContent="",help_msg.innerHTML="",fileLink_load.innerHTML='<span class="font-bold text-gray-500">loading <i class="fa-solid fa-spinner fa-spin-pulse"></i></span>',setTimeout((()=>{copy_msg.innerHTML='Tap to copy <i class="fa-solid fa-copy"></i>',link_newtab.href=e,link_newtab.classList.add("text-white","focus:ring-4","font-medium","rounded-lg","text-sm","px-5","py-2.5","bg-blue-600","hover:bg-blue-700"),link_newtab.innerHTML=' <i class="fa-solid fa-up-right-from-square"></i>',link_newtab.target="_blank",link_newtab.title="Open in new tab",orscan.innerHTML='or Scan <i class="fa-solid fa-expand"></i>',help_msg.innerHTML=`<i class="fas fa-question-circle text-blue-500 text-2xl"></i><div class="help-content"><p class="select-none text-sm text-center text-gray-700">Python file will be deleted after download.<br> Expires on <span class="font-bold">${new Date(i.expires).toLocaleDateString("en-US",dateformat)}</span></p></div>`,orscan.classList.add("select-none","block","pt-2","mb-2","text-lg","text-neutral-500","font-medium"),close_Popup.classList.remove("hidden"),qrCode.style.textAlign="-moz-center",qrCode.style.textAlign="-webkit-center",qrCode.style.background="rgb(255, 255, 255)",qrCode.classList.add("ml-12","p-2","mr-12","mt-2"),file_Link.classList.remove("hidden"),fileLink_load.innerHTML="",displayQRCode(e),qrCode.classList.remove("inline"),file_Link.href=e,file_Link.value=e}),1500)}else minifiedSizeSpan.textContent="Error generating share link"}catch{minifiedSizeSpan.textContent="Error during fetch request"}}function createFormData(e,t){shuffleArray(sentences);const n=new FormData,i=new Blob([e],{type:"application/x-python"});return n.append("file",i,t),n.append("description",`Python Minifier - Glad432 (glad432.github.io)\n${sentences[0]}`),n}function displayQRCode(e){new QRCode(qrCode,{text:e,width:128,height:128,correctLevel:QRCode.CorrectLevel.H})}function closePopup(){qrCode.classList.remove("ml-12","p-2","mr-12","mt-2"),orscan.classList.remove("select-none","block","pt-2","mb-2","text-lg","text-neutral-500","font-medium"),link_newtab.classList.remove("text-white","bg-blue-600","hover:bg-blue-700","focus:ring-4","font-medium","rounded-lg","text-sm","px-5","py-2.5"),qrCode.style.textAlign="",qrCode.style.background="",close_Popup.classList.add("hidden"),overlay.classList.add("hidden"),popup.classList.add("hidden"),document.body.classList.remove("overflow-y-hidden"),document.body.classList.add("overflow-y-scroll"),qrCode.innerHTML="",qrCode.title="",fileLink_load.innerHTML="",file_Link.value="",copy_msg.innerHTML="",orscan.innerHTML="",help_msg.innerHTML="",link_newtab.innerHTML="",link_newtab.href="",link_newtab.target=""}async function copyfilelink(){await navigator.clipboard.writeText(file_Link.value),cpyTimeout1&&clearTimeout(cpyTimeout1),copy_msg.innerHTML='Copied <i class="fa-solid fa-copy fa-fade"></i>',cpyTimeout1=setTimeout((()=>{copy_msg.innerHTML='Tap to copy <i class="fa-solid fa-copy"></i>',cpyTimeout1=null}),3e3)}function updateLineCount(){document.getElementById("line-count").textContent=`Line Count: ${sourceEditor.lineCount()}`,document.getElementById("text-size").textContent=`${(sourceEditor.getValue().length/1024).toFixed(3)} kB`}function updateLineCount_out(){document.getElementById("line-count-out").textContent=`Line Count: ${minifiedEditor.lineCount()}`}function initializeMinifier(){minifyButton.addEventListener("click",(async function(){if(minifyButton.disabled=!1,shareButton.disabled=!0,copyButton.disabled=!0,dwButton.disabled=!0,selectallopt.disabled=!0,unselectallopt.disabled=!0,selectallopt.classList.add("cursor-not-allowed"),unselectallopt.classList.add("cursor-not-allowed"),minifiedEditor.setValue(""),animateIcon("fade-0","fa-fade",1500),minifiedSizeSpan.innerHTML='<i class="fa-solid fa-spinner fa-spin-pulse"></i> Loading....',""!==sourceEditor.getValue())try{const e=await fetch("https://api.python-minifier.com/minify?"+function(){let e=["combine_imports","remove_pass","remove_literal_statements","remove_annotations","hoist_literals","rename_locals","rename_globals","convert_posargs_to_args","preserve_shebang","remove_asserts","remove_debug","remove_explicit_return_none"].map((e=>`${e}=${document.getElementById(e).checked}`)).join("&");const t=document.getElementById("preserve_globals").value;t&&(e+="&preserve_globals="+encodeURIComponent(t));const n=document.getElementById("preserve_locals").value;return n&&(e+="&preserve_locals="+encodeURIComponent(n)),e}(),{method:"POST",headers:{"Content-Type":"text/plain"},body:pysource.value});if(e.ok){const t=await e.text();minifiedEditor.setValue(t),minifiedEditor.scrollTo(1,1),minifiedEditor.setCursor({line:1,ch:0}),minifiedSizeSpan.textContent=`${(t.length/1024).toFixed(3)} kB`,copyButton.disabled=!1,shareButton.disabled=!1,dwButton.disabled=!1}else copyButton.disabled=!0,shareButton.disabled=!0,dwButton.disabled=!0,minifiedSizeSpan.innerHTML=`${excir} Error`}catch{shareButton.disabled=!0,copyButton.disabled=!0,dwButton.disabled=!0,minifiedSizeSpan.innerHTML=`${excir} Something went wrong!!`}else minifiedSizeSpan.textContent="Enter Code";selectallopt.disabled=!1,unselectallopt.disabled=!1,selectallopt.classList.remove("cursor-not-allowed"),unselectallopt.classList.remove("cursor-not-allowed"),minifyButton.disabled=!1})),copyButton.addEventListener("click",(async function(){await navigator.clipboard.writeText(minifiedEditor.getValue()),minifiedEditor.setSelection({line:0,ch:0},{line:minifiedEditor.lastLine(),ch:minifiedEditor.getLineHandle(minifiedEditor.lastLine()).text.length}),cpyTimeout0&&clearTimeout(cpyTimeout0),copyButton.innerHTML='Copied <i class="fa-solid fa-clipboard fa-fade"></i>',cpyTimeout0=setTimeout((()=>{copyButton.innerHTML='Copy <i class="fa-solid fa-clipboard"></i>',cpyTimeout0=null}),2500)}));["combine_imports","remove_pass","remove_literal_statements","remove_annotations","hoist_literals","rename_locals","rename_globals","convert_posargs_to_args","preserve_shebang","remove_asserts","remove_debug","remove_explicit_return_none"].forEach((e=>{const t=document.getElementById(e);t&&t.addEventListener("change",(()=>{minifiedEditor.setValue("")}))})),minifyButton.disabled=!1}function clearSource(){animateIcon("fade-5","fa-fade",1500),shareButton.disabled=!0,dwButton.disabled=!0,copyButton.disabled=!0,handleFilename(),handleErrorMessage(),fileInput.value="",pysource.textContent="",minifiedEditor.setValue(""),sourceEditor.setValue(""),fileLinkInput.value="",minifiedSizeSpan.textContent="0.000 kB"}function animateIcon(e,t,n){let i;i&&clearTimeout(i);var o=document.getElementById(e);o.classList.add(t),i=setTimeout((()=>{o.classList.remove(t),i=null}),n)}function handleFilename(e){void 0===e?(fileNameDisplay.textContent="",fileNameDisplay.classList.remove(...classlst0)):(fileNameDisplay.innerHTML=e,fileNameDisplay.classList.add(...classlst0))}function handleErrorMessage(e){void 0===e?(errorMessage.textContent="",errorMessage.classList.remove(...classlst)):(errorTimeout&&clearTimeout(errorTimeout),errorMessage.innerHTML=e,errorMessage.classList.add(...classlst),errorTimeout=setTimeout((()=>{errorMessage.classList.remove(...classlst),errorMessage.innerHTML="",errorTimeout=null}),3500))}function toggleContent1(){content.style.maxHeight?content.style.maxHeight=null:content.style.maxHeight=content.scrollHeight+"px"}function tickAllAndSetGlobals(){checkboxes.forEach((e=>{e.checked=!0})),preservedGlobalsInput.value="handler"}function resetOptions(){checkboxes.forEach((e=>{e.checked=!1})),preservedGlobalsInput.value="handler",document.querySelectorAll('input[type="text"]:not(#preserve_globals)').forEach((e=>{e.value=""}))}function input_from_url(){animateIcon("fade-4","fa-fade",1e3);var e=document.getElementById("inputContainer");e.classList.toggle("hidden"),e.classList.toggle("flex")}function show_article(){animateIcon("rot-1","fa-fade",1e3);const e=document.getElementById("display-content"),t=document.getElementById("rot-1");e.classList.toggle("content"),t.classList.toggle("fa-caret-down"),e.classList.toggle("hidden"),t.classList.toggle("fa-caret-up")}CodeMirror.registerHelper("hint","anyword",((e,t)=>{for(var n=t.words||words,i=e.getCursor(),o=e.getLine(i.line),a=i.ch,l=a;l<o.length&&/[\w$]+/.test(o.charAt(l));)++l;for(;a&&/[\w$]+/.test(o.charAt(a-1));)--a;var r=o.slice(a,l).toLowerCase();return{list:n.filter((e=>e.toLowerCase().startsWith(r))),from:CodeMirror.Pos(i.line,a),to:CodeMirror.Pos(i.line,l)}})),sourceEditor.on("beforeChange",((e,t)=>{new Blob([sourceEditor.getValue()]).size+new Blob([t.text.join("")]).size-t.to-t.from>1048576&&t.cancel()})),minifiedEditor.on("keydown",readonlyalert),window.addEventListener("load",setupFileInput),document.getElementById("dw").addEventListener("click",dw_py),shareButton.addEventListener("click",validateCH),close_Popup.addEventListener("click",closePopup),file_Link.addEventListener("click",copyfilelink),sourceEditor.on("change",(()=>{pysource.value=sourceEditor.getValue(),updateLineCount(),updateEditorState()})),minifiedEditor.on("change",updateLineCount_out),window.addEventListener("DOMContentLoaded",initializeMinifier),document.getElementById("rm").addEventListener("click",clearSource),document.getElementById("toggleContent1").addEventListener("click",toggleContent1),selectallopt.addEventListener("click",tickAllAndSetGlobals),unselectallopt.addEventListener("click",resetOptions),document.addEventListener("DOMContentLoaded",(()=>{function e(){var e,t=fileLinkInput.value.trim();""===fileLinkInput.value||/^[^\s\d]+$/.test(t)&&!/\.[a-zA-Z]{2,}$/.test(t)?handleFilename():/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/.test(t)?/\.(py)$/.test(t.toLowerCase())?(handleErrorMessage(),animateIcon("fade-3","fa-fade",1500),e=t,fetch(e).then((t=>{t.ok||sourceEditor.setValue("");const n=t.headers.get("content-disposition"),i=n&&n.match(/filename="(.+)"/),o=i?i[1]:e.split("/").pop();handleFilename(`${code_file} ${o}`);const a=t.headers.get("content-length");if(a&&parseInt(a,10)>1048576)throw new Error("File size exceeds 1MB limit");return t.text()})).then((e=>{sourceEditor.setValue(e)})).catch((e=>{handleFilename(),handleErrorMessage(`${exctri} ${e.message}`)}))):(handleFilename(),handleErrorMessage(`${exctri} Please enter a valid .py file link`)):(handleFilename(),handleErrorMessage(`${exctri} Please enter a valid URL starting with "https://"`))}document.getElementById("load_File").addEventListener("click",e),document.getElementById("sample_link").addEventListener("click",(()=>{const t="https://gist.githubusercontent.com/glad432/4d1935413e012cd54130a1fc6f31b4bf/raw/5f3aaae4b9a360b64a1146e6540804af4a91b7b1/sample.py";fileLinkInput.value!==t&&(fileLinkInput.value=t,e(),animateIcon("fade-6","fa-bounce",1e3))})),document.getElementById("clear_link").addEventListener("click",(()=>{""!==fileLinkInput.value&&(fileLinkInput.value="",animateIcon("fade-7","fa-fade",1e3))}))})),document.getElementById("from_url").addEventListener("click",input_from_url),document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("show-btn").addEventListener("click",show_article)})),document.addEventListener("DOMContentLoaded",(async()=>{const e=await fetch("https://glad432.github.io/article/blog.json"),t=await e.json();document.getElementById("article").innerHTML=`<div id="display-content" class="hidden overflow-y-auto max-h-[100%]"><h1 class="sm:text-xl lg:text-3xl before:font-['Font_Awesome_6_Free'] before:content-['&#xf05a'] before:text-blue-500 before:pr-2 text-gray-600 text-left font-bold mb-4">${t?.article?.title}</h1>${t?.article?.sections.map((e=>`<div class="mb-4"><h2 class="text-[15px] text-gray-500 before:font-['Font_Awesome_6_Free'] before:content-['&#xf219'] before:text-cyan-900 before:pr-2 lg:text-xl font-bold py-4">${e?.section_title}</h2><p class="text-[13px] lg:text-[15px]">${e?.section_content}</p></div>`)).join("")}</div>`}));
